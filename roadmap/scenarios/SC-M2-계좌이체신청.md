# Scenario: M2 - 계좌이체 신청 & Beta 오픈

**Work Package:** WP-M2
**총 Scenario 수:** 43개
**작성일:** 2026-01-29

---

## Phase 1: 카카오 로그인 & 신청 기반

### 🔴 Critical Scenarios

**Scenario M2-001: 카카오 로그인 성공**
- **Given:** 로그인 페이지
- **When:** 카카오 로그인 버튼 클릭 후 카카오 인증 완료
- **Then:** 홈 화면으로 이동, 사용자 정보 표시
- **선행:** 없음

**Scenario M2-002: 카카오 신규 가입 - 닉네임 설정**
- **Given:** 카카오 첫 로그인 (계정 없음)
- **When:** 카카오 인증 완료
- **Then:** 닉네임 설정 페이지로 이동 (또는 닉네임 입력 모달 표시)
- **선행:** M2-001

**Scenario M2-003: RLS 정책 - 본인 신청만 조회**
- **Given:** 사용자 A의 신청 데이터 존재
- **When:** 사용자 B가 신청 목록 조회
- **Then:** 사용자 A의 신청은 조회되지 않음
- **선행:** M2-004

### 🟡 High Scenarios

**Scenario M2-004: 신청 데이터 구조 검증**
- **Given:** registrations 테이블 생성 완료
- **When:** 테스트 데이터 삽입
- **Then:** 상태(pending_transfer, confirmed, cancelled, expired, waiting) 저장됨
- **선행:** 없음

**Scenario M2-005: 카카오 로그인 취소**
- **Given:** 카카오 인증 페이지
- **When:** 사용자가 인증 취소
- **Then:** 로그인 페이지로 복귀, 에러 메시지 없음
- **선행:** 없음

**Scenario M2-006: 카카오 로그인 실패 - 콜백 에러**
- **Given:** 카카오 인증 완료 후 콜백
- **When:** 콜백 처리 중 에러 발생
- **Then:** 로그인 페이지로 리다이렉트, "로그인에 실패했습니다" 메시지 표시
- **선행:** 없음

---

## Phase 2: 계좌이체 신청 플로우

### 🔴 Critical Scenarios

**Scenario M2-007: 계좌이체 신청 성공**
- **Given:** 정원이 남은 모임 상세 페이지
- **When:** "신청하기" -> 입금자명 입력 -> "입금했습니다" 클릭
- **Then:** 신청 생성, 정원 예약, 마이페이지에서 "입금대기" 표시
- **선행:** M1-030

**Scenario M2-008: 정원 초과 방지 (동시성)**
- **Given:** 정원 10명, 현재 9명 신청
- **When:** 2명이 동시에 신청 시도
- **Then:** 1명만 성공, 1명은 정원 마감 메시지
- **선행:** M2-007

**Scenario M2-009: 정원 마감 시 신청 버튼 비활성화**
- **Given:** 정원이 가득 찬 모임
- **When:** 상세 페이지 진입
- **Then:** "마감" 뱃지 표시, 신청 버튼 비활성화
- **선행:** M1-030

### 🟡 High Scenarios

**Scenario M2-010: 계좌번호 클립보드 복사**
- **Given:** 신청 모달에서 계좌 정보 표시
- **When:** 복사 버튼 클릭
- **Then:** 클립보드에 계좌번호 복사, 토스트 메시지 표시
- **선행:** M2-007

**Scenario M2-011: 입금자명 형식 검증 성공**
- **Given:** 입금자명 입력 중
- **When:** "0128_홍길동" 형식 입력
- **Then:** 유효성 검사 통과, 제출 가능
- **선행:** M2-007

**Scenario M2-012: 입금자명 형식 검증 실패**
- **Given:** 입금자명 입력 중
- **When:** "홍길동" (날짜 없음) 또는 "0128홍길동" (언더스코어 없음) 입력
- **Then:** 에러 메시지 표시, 제출 불가
- **선행:** M2-007

**Scenario M2-013: 48시간 만료 시간 기록**
- **Given:** 계좌이체 신청 완료
- **When:** 신청 데이터 확인
- **Then:** expires_at에 48시간 후 시간이 기록됨
- **선행:** M2-007

### 🟢 Medium Scenarios

**Scenario M2-014: 참가 인원 실시간 반영**
- **Given:** 모임 상세 페이지 표시 중
- **When:** 다른 사용자가 신청 완료
- **Then:** "O명 참여" 숫자가 업데이트됨
- **선행:** M2-007

---

## Phase 3: 운영자 입금 확인

### 🔴 Critical Scenarios

**Scenario M2-015: 입금 확인 목록 조회**
- **Given:** 운영자 로그인
- **When:** 입금 확인 페이지 진입
- **Then:** pending_transfer 상태 신청 목록 표시
- **선행:** M1-022

**Scenario M2-016: 입금 확인 처리**
- **Given:** 입금 확인 목록에서 신청 선택
- **When:** "입금 확인" 버튼 클릭
- **Then:** 상태가 confirmed로 변경, 목록에서 제거
- **선행:** M2-015

**Scenario M2-017: 48시간 미입금 자동 만료**
- **Given:** pending_transfer 상태로 48시간 경과
- **When:** Cron 작업 실행
- **Then:** 상태가 expired로 변경, 정원 반환
- **선행:** M2-007

### 🟡 High Scenarios

**Scenario M2-018: 비운영자 입금 확인 페이지 접근 차단**
- **Given:** 일반 사용자 로그인
- **When:** 운영자 입금 확인 페이지 접근 시도
- **Then:** 403 에러 또는 홈으로 리다이렉트
- **선행:** M1-012

**Scenario M2-019: 입금자명으로 검색**
- **Given:** 입금 확인 목록 페이지
- **When:** 입금자명 검색어 입력
- **Then:** 해당 입금자명을 포함한 신청만 필터링
- **선행:** M2-015

**Scenario M2-020: 신청자 정보 표시**
- **Given:** 입금 확인 목록
- **When:** 목록 확인
- **Then:** 실명, 닉네임, 입금자명, 신청일시, 모임명 표시
- **선행:** M2-015

### 🟢 Medium Scenarios

**Scenario M2-021: 확정 시간 기록**
- **Given:** 입금 확인 처리
- **When:** confirmed 상태로 변경
- **Then:** confirmed_at에 현재 시간 기록
- **선행:** M2-016

---

## Phase 4: 취소/환불 & 대기 시스템

### 🔴 Critical Scenarios

**Scenario M2-022: 참가 취소 요청**
- **Given:** confirmed 상태의 신청
- **When:** "취소하기" -> 사유 입력 -> 환불 계좌 입력 -> 확인
- **Then:** 상태가 cancelled로 변경, 환불 계좌 저장
- **선행:** M2-016

**Scenario M2-023: 취소 시 정원 반환**
- **Given:** 정원 10명, 10명 확정
- **When:** 1명이 취소
- **Then:** 참가 인원 9명으로 감소, 신청 버튼 활성화
- **선행:** M2-022

**Scenario M2-024: 대기 등록**
- **Given:** 정원이 가득 찬 모임
- **When:** "대기 신청" 클릭
- **Then:** waiting 상태로 등록, 대기 순번 표시
- **선행:** M2-009

### 🟡 High Scenarios

**Scenario M2-025: 취소 사유 필수 입력**
- **Given:** 취소 모달 표시
- **When:** 취소 사유 입력 없이 확인 클릭
- **Then:** "취소 사유를 입력해주세요" 에러 표시
- **선행:** M2-022

**Scenario M2-026: 환불 계좌 필수 입력**
- **Given:** 취소 모달 표시 (계좌이체 결제 건)
- **When:** 환불 계좌 입력 없이 확인 클릭
- **Then:** "환불 받을 계좌를 입력해주세요" 에러 표시
- **선행:** M2-022

**Scenario M2-027: 대기자 목록 조회 (운영자)**
- **Given:** 운영자 로그인, 대기자 존재
- **When:** 대기자 관리 페이지 진입
- **Then:** 대기자 목록 순번별 표시
- **선행:** M2-024

**Scenario M2-028: 중복 신청 차단**
- **Given:** 이미 confirmed 상태로 신청한 모임
- **When:** 같은 모임에 다시 신청 시도
- **Then:** "이미 신청한 모임입니다" 에러 표시
- **선행:** M2-016

**Scenario M2-029: 중복 대기 차단**
- **Given:** 이미 waiting 상태로 대기 중인 모임
- **When:** 같은 모임에 다시 대기 신청 시도
- **Then:** "이미 대기 중인 모임입니다" 에러 표시
- **선행:** M2-024

### 🟢 Medium Scenarios

**Scenario M2-030: 모임 전만 취소 가능**
- **Given:** 이미 종료된 모임의 신청
- **When:** 취소 시도
- **Then:** 취소 버튼 비활성화 또는 "종료된 모임은 취소할 수 없습니다" 메시지
- **선행:** M2-022

---

## Phase 5: 마이페이지 신청 내역

### 🔴 Critical Scenarios

**Scenario M2-031: 신청 내역 조회**
- **Given:** 로그인 후 신청 내역 존재
- **When:** 마이페이지 진입
- **Then:** 모든 신청 내역이 상태별로 표시
- **선행:** M1-031

### 🟡 High Scenarios

**Scenario M2-032: 입금대기 상태 표시**
- **Given:** pending_transfer 상태 신청
- **When:** 마이페이지에서 확인
- **Then:** "입금대기" 뱃지, 남은 시간(XX시간 XX분) 표시
- **선행:** M2-031

**Scenario M2-033: 신청완료 상태 표시**
- **Given:** confirmed 상태 신청
- **When:** 마이페이지에서 확인
- **Then:** "신청완료" 뱃지 표시
- **선행:** M2-031

**Scenario M2-034: 취소됨 상태 표시**
- **Given:** cancelled 상태 신청
- **When:** 마이페이지에서 확인
- **Then:** "취소됨" 뱃지 표시, 환불 진행 안내
- **선행:** M2-031

**Scenario M2-035: 만료됨 상태 표시**
- **Given:** expired 상태 신청 (48시간 미입금)
- **When:** 마이페이지에서 확인
- **Then:** "만료됨" 뱃지 표시
- **선행:** M2-031

**Scenario M2-036: 대기중 상태 표시**
- **Given:** waiting 상태 신청
- **When:** 마이페이지에서 확인
- **Then:** "대기중" 뱃지, 대기 순번 표시
- **선행:** M2-031

**Scenario M2-037: 신청 내역 상세 정보**
- **Given:** 마이페이지 신청 내역
- **When:** 내역 카드 확인
- **Then:** 모임명, 일시, 금액 표시
- **선행:** M2-031

### 🟢 Medium Scenarios

**Scenario M2-038: 취소 버튼 조건부 표시**
- **Given:** 마이페이지 신청 내역
- **When:** confirmed 상태 & 모임 전인 신청 확인
- **Then:** 취소 버튼 표시됨
- **선행:** M2-031

**Scenario M2-039: 취소 버튼 숨김 - 모임 종료 후**
- **Given:** 마이페이지 신청 내역
- **When:** 이미 종료된 모임의 신청 확인
- **Then:** 취소 버튼 표시되지 않음
- **선행:** M2-031

---

## 추가: 운영자 환불 관리

### 🔴 Critical Scenarios

**Scenario M2-040: 환불대기 목록 조회**
- **Given:** 운영자 로그인, cancelled 상태 신청 존재
- **When:** 환불 관리 페이지 진입
- **Then:** 환불 대기 목록 표시 (환불 계좌 정보 포함)
- **선행:** M2-022

**Scenario M2-041: 환불 완료 처리**
- **Given:** 환불대기 목록에서 신청 선택
- **When:** "환불 완료" 버튼 클릭
- **Then:** 환불 완료 상태로 변경, 완료 일시 기록
- **선행:** M2-040

### 🟡 High Scenarios

**Scenario M2-042: 환불 계좌 정보 확인**
- **Given:** 환불대기 목록
- **When:** 목록 확인
- **Then:** 은행명, 계좌번호, 예금주, 환불 금액 표시
- **선행:** M2-040

**Scenario M2-043: 비운영자 환불 관리 접근 차단**
- **Given:** 일반 사용자 로그인
- **When:** 환불 관리 페이지 접근 시도
- **Then:** 403 에러 또는 홈으로 리다이렉트
- **선행:** M1-012

---

## 요약

| 분류 | 개수 |
|------|:----:|
| 🔴 Critical | 16개 |
| 🟡 High | 21개 |
| 🟢 Medium | 6개 |
| **총계** | **43개** |

### Phase별 분포

| Phase | Critical | High | Medium | 합계 |
|-------|:--------:|:----:|:------:|:----:|
| Phase 1: 카카오 로그인 & 신청 기반 | 3 | 3 | 0 | 6 |
| Phase 2: 계좌이체 신청 플로우 | 3 | 4 | 1 | 8 |
| Phase 3: 운영자 입금 확인 | 3 | 3 | 1 | 7 |
| Phase 4: 취소/환불 & 대기 시스템 | 3 | 5 | 1 | 9 |
| Phase 5: 마이페이지 신청 내역 | 1 | 6 | 2 | 9 |
| 추가: 운영자 환불 관리 | 2 | 2 | 0 | 4 |

### 핵심 의존성 체인

```
M1-012 (로그인)
    ↓
M1-030 (모임 상세)
    ↓
M2-007 (계좌이체 신청)
    ↓
M2-016 (입금 확인)
    ↓
M2-022 (취소 요청)
    ↓
M2-041 (환불 완료)
```

### 대기 시스템 의존성

```
M2-009 (정원 마감)
    ↓
M2-024 (대기 등록)
    ↓
M2-023 (취소 시 정원 반환)
    → [M3에서 구현] 대기자 자동 알림
```

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|----------|
| 2026-01-29 | 1.0 | SC-M2 최초 작성 (WP-M2에서 분리) |
