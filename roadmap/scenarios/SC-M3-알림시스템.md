# Scenario: M3 - 알림 시스템

**Work Package:** WP-M3
**총 Scenario 수:** 38개
**작성일:** 2026-01-29

---

## Phase 1: 알림 인프라 구축

### 🔴 Critical Scenarios

**Scenario M3-001: 솔라피 API 연동 확인**
- **Given:** 솔라피 API 키가 환경 변수에 설정되어 있음
- **When:** API 연결 테스트 실행
- **Then:** 연결 성공 응답 반환
- **선행:** 없음

**Scenario M3-002: 알림톡 발송 성공**
- **Given:** 솔라피 API 키가 설정되고, 알림톡 템플릿이 카카오에서 승인된 상태
- **When:** 유효한 전화번호로 테스트 알림 발송 실행
- **Then:** 카카오톡 알림톡 수신 성공, 발송 상태 "success" 반환
- **선행:** M3-001

**Scenario M3-003: 발송 성공 기록 저장**
- **Given:** 알림 발송 성공
- **When:** 발송 완료 콜백 처리
- **Then:** notification_logs에 status="success", sent_at, recipient, message_type 저장
- **선행:** M3-002

### 🟡 High Scenarios

**Scenario M3-004: 알림톡 발송 실패 - 잘못된 API 키**
- **Given:** 솔라피 API 키가 잘못 설정된 상태
- **When:** 테스트 알림 발송 실행
- **Then:** 인증 오류 반환, 발송 상태 "failed" 기록
- **선행:** 없음

**Scenario M3-005: 알림톡 발송 실패 - 잘못된 전화번호**
- **Given:** 솔라피 API 설정 완료
- **When:** 유효하지 않은 전화번호(예: "0000")로 발송 시도
- **Then:** 전화번호 오류 반환, notification_logs에 status="failed", error_message 저장
- **선행:** M3-002

**Scenario M3-006: 발송 실패 기록 저장**
- **Given:** 알림 발송 실패 (API 오류 또는 전화번호 오류)
- **When:** 발송 완료 콜백 처리
- **Then:** notification_logs에 status="failed", error_message 저장
- **선행:** M3-004

### 🟢 Medium Scenarios

**Scenario M3-007: 알림 서비스 추상화 검증**
- **Given:** NotificationService 인터페이스와 SolapiNotificationService 구현체 존재
- **When:** MockNotificationService 구현체 생성
- **Then:** 인터페이스만 구현하면 기존 코드 변경 없이 교체 가능
- **선행:** M3-002

**Scenario M3-008: notification_logs 테이블 생성 확인**
- **Given:** 마이그레이션 실행
- **When:** notification_logs 테이블 조회
- **Then:** 테이블 존재, 필수 컬럼(id, recipient, message_type, status, sent_at, error_message) 확인
- **선행:** 없음

---

## Phase 2: 모임 리마인드 알림

### 🔴 Critical Scenarios

**Scenario M3-009: 3일 전 리마인드 발송**
- **Given:** 모임이 3일 후 예정, confirmed 상태 참가자 2명 존재
- **When:** 리마인드 Cron 실행 (오전 7시)
- **Then:** 2명 모두에게 "3일 후 [모임명] 모임이 있습니다" 알림 발송
- **선행:** M3-002

**Scenario M3-010: 1일 전 리마인드 발송**
- **Given:** 모임이 내일 예정, confirmed 상태 참가자 존재
- **When:** 리마인드 Cron 실행 (오전 7시)
- **Then:** "내일 [모임명] 모임이 있습니다" 알림 발송
- **선행:** M3-002

**Scenario M3-011: 당일 리마인드 발송**
- **Given:** 모임이 오늘 예정, confirmed 상태 참가자 존재
- **When:** 리마인드 Cron 실행 (오전 7시)
- **Then:** "오늘 [모임명] 모임입니다" 알림 발송
- **선행:** M3-002

### 🟡 High Scenarios

**Scenario M3-012: 취소된 참가자 리마인드 제외**
- **Given:** 모임 3일 전, 참가자 A(confirmed), 참가자 B(cancelled)
- **When:** 리마인드 Cron 실행
- **Then:** 참가자 A에게만 알림 발송, B는 제외
- **선행:** M3-009

**Scenario M3-013: 중복 발송 방지**
- **Given:** 3일 전 리마인드가 이미 발송됨 (notification_logs에 기록 존재)
- **When:** Cron이 같은 날 다시 실행
- **Then:** 동일 (회원, 모임, 알림타입) 조합으로 재발송되지 않음
- **선행:** M3-009

**Scenario M3-014: 대기자 리마인드 제외**
- **Given:** 모임 3일 전, 참가자 A(confirmed), 참가자 B(waiting)
- **When:** 리마인드 Cron 실행
- **Then:** 참가자 A에게만 알림 발송, 대기자 B는 제외
- **선행:** M3-009

### 🟢 Medium Scenarios

**Scenario M3-015: 리마인드 대상 없음 처리**
- **Given:** 모임 3일 전이지만 confirmed 상태 참가자 0명
- **When:** 리마인드 Cron 실행
- **Then:** 알림 발송 없음, 오류 없이 정상 종료
- **선행:** M3-009

**Scenario M3-016: 리마인드 메시지에 모임 정보 포함**
- **Given:** 모임 정보: 이름="1월 정기모임", 일시="2026-02-01 14:00", 장소="경주 카페A"
- **When:** 3일 전 리마인드 발송
- **Then:** 메시지에 모임명, 일시, 장소 정보 포함
- **선행:** M3-009

---

## Phase 3: 대기자 및 세그먼트 알림

### 🔴 Critical Scenarios

**Scenario M3-017: 대기자 자리 발생 알림**
- **Given:** 모임 정원 마감, 대기자 A(1순위), B(2순위) 존재
- **When:** 참가자 1명 취소 처리 완료
- **Then:** 1순위 대기자 A에게만 "자리가 났습니다" 알림 발송
- **선행:** M3-002

**Scenario M3-018: 대기자 응답 시간 (D-3 이상) - 24시간 초과**
- **Given:** 모임 4일 전, 대기자 A에게 알림 발송 후 24시간 경과, 미응답
- **When:** 응답 시간 초과 체크 Cron 실행
- **Then:** 대기자 A 만료 처리, 대기자 B에게 알림 발송
- **선행:** M3-017

**Scenario M3-019: 월말 참여 독려 알림**
- **Given:** 월말(25~31일), 이번 달 confirmed 모임 0건인 회원 존재
- **When:** 월말 알림 Cron 실행
- **Then:** "[닉네임]님, 이번 달 아직 모임이 없어요" 알림 발송
- **선행:** M3-002

### 🟡 High Scenarios

**Scenario M3-020: 대기자 없을 때 취소 처리**
- **Given:** 모임에 대기자 0명
- **When:** 참가자 1명 취소 처리 완료
- **Then:** 대기자 알림 발송 없음, 정원만 복구
- **선행:** M3-017

**Scenario M3-021: 대기자 응답 시간 (D-2) - 6시간 초과**
- **Given:** 모임 2일 전, 대기자 A에게 알림 발송 후 6시간 경과, 미응답
- **When:** 응답 시간 초과 체크 Cron 실행
- **Then:** 대기자 A 만료 처리, 다음 대기자에게 알림 발송
- **선행:** M3-017

**Scenario M3-022: 대기자 응답 시간 (D-1) - 2시간 초과**
- **Given:** 모임 1일 전, 대기자 A에게 알림 발송 후 2시간 경과, 미응답
- **When:** 응답 시간 초과 체크 Cron 실행
- **Then:** 대기자 A 만료 처리, 다음 대기자에게 알림 발송
- **선행:** M3-017

**Scenario M3-023: 대기자가 응답 시간 내 결제 완료**
- **Given:** 대기자 A에게 자리 발생 알림 발송됨, 응답 시간 내
- **When:** 대기자 A가 결제 완료
- **Then:** 대기자 A가 confirmed 상태로 전환, 다음 대기자 알림 없음
- **선행:** M3-017

**Scenario M3-024: 월말 알림 대상 제외 - 이미 참여 예정**
- **Given:** 월말, 회원 A는 이번 달 confirmed 모임 1건 존재
- **When:** 월말 알림 Cron 실행
- **Then:** 회원 A에게 알림 발송하지 않음
- **선행:** M3-019

**Scenario M3-025: 온보딩 이탈 위험 알림**
- **Given:** 가입 후 45일 경과, 첫 정기모임 참여 완료 후 두 번째 참여 없음
- **When:** 세그먼트 알림 Cron 실행
- **Then:** 복귀 유도 알림 발송
- **선행:** M3-002

### 🟢 Medium Scenarios

**Scenario M3-026: 휴면 위험 알림**
- **Given:** 마지막 참여 완료 후 3개월 경과
- **When:** 세그먼트 알림 Cron 실행
- **Then:** 휴면 위험 복귀 유도 알림 발송
- **선행:** M3-002

**Scenario M3-027: 자격 만료 임박 알림**
- **Given:** 마지막 정기모임 참여 완료 후 5개월 경과
- **When:** 세그먼트 알림 Cron 실행
- **Then:** "정기모임 자격이 곧 만료됩니다" 긴급 알림 발송
- **선행:** M3-002

**Scenario M3-028: 세그먼트 알림 중복 방지**
- **Given:** 온보딩 이탈 위험 알림이 이미 발송됨
- **When:** 세그먼트 알림 Cron 재실행
- **Then:** 동일 세그먼트 알림 재발송되지 않음 (30일 간격)
- **선행:** M3-025

---

## Phase 4: 운영자 알림 관리

### 🔴 Critical Scenarios

**Scenario M3-029: 수동 알림 발송 - 전체 회원**
- **Given:** 운영자 로그인, 알림 관리 페이지 진입
- **When:** 대상 "전체 회원" 선택 -> 메시지 입력 -> 발송 버튼 클릭
- **Then:** 전체 회원에게 알림 발송, notification_logs에 이력 저장
- **선행:** M3-002

**Scenario M3-030: 수동 알림 발송 - 특정 모임 참가자**
- **Given:** 운영자 로그인, 알림 관리 페이지 진입
- **When:** 대상 "특정 모임" 선택 -> 모임 선택 -> 메시지 입력 -> 발송
- **Then:** 해당 모임 confirmed 참가자에게만 알림 발송
- **선행:** M3-029

**Scenario M3-031: 알림 이력 조회**
- **Given:** 알림 발송 이력 10건 존재
- **When:** 알림 이력 페이지 진입
- **Then:** 발송 일시, 대상(전체/모임명/개인명), 성공/실패 여부 목록 표시
- **선행:** M3-029

### 🟡 High Scenarios

**Scenario M3-032: 수동 알림 발송 - 개인**
- **Given:** 운영자 로그인, 알림 관리 페이지 진입
- **When:** 대상 "개인" 선택 -> 회원 검색/선택 -> 메시지 입력 -> 발송
- **Then:** 선택된 개인에게만 알림 발송
- **선행:** M3-029

**Scenario M3-033: 수동 알림 발송 실패 - 메시지 미입력**
- **Given:** 운영자 로그인, 알림 관리 페이지 진입, 대상 선택 완료
- **When:** 메시지 입력 없이 발송 버튼 클릭
- **Then:** "메시지를 입력해주세요" 오류 표시, 발송 안됨
- **선행:** M3-029

**Scenario M3-034: 알림 이력 필터링**
- **Given:** 알림 발송 이력 중 성공 7건, 실패 3건 존재
- **When:** "실패만 보기" 필터 적용
- **Then:** 실패 3건만 표시
- **선행:** M3-031

**Scenario M3-035: 발송 실패 재시도**
- **Given:** 발송 실패 건 존재 (status="failed")
- **When:** 해당 건의 "재시도" 버튼 클릭
- **Then:** 알림 재발송 시도, 결과에 따라 상태 업데이트
- **선행:** M3-031

**Scenario M3-036: 비운영자 알림 관리 접근 차단**
- **Given:** 일반 회원 로그인 상태
- **When:** /admin/notifications 페이지 직접 접근 시도
- **Then:** 403 Forbidden 또는 홈으로 리다이렉트
- **선행:** 없음

### 🟢 Medium Scenarios

**Scenario M3-037: 알림 이력 페이지네이션**
- **Given:** 알림 발송 이력 100건 존재
- **When:** 알림 이력 페이지 진입
- **Then:** 20건씩 페이지네이션 표시, 다음 페이지로 이동 가능
- **선행:** M3-031

**Scenario M3-038: 알림 이력 날짜 필터링**
- **Given:** 알림 발송 이력 중 최근 7일간 20건, 이전 30건 존재
- **When:** "최근 7일" 필터 적용
- **Then:** 최근 7일간 발송된 20건만 표시
- **선행:** M3-031

---

## 요약

| 분류 | 개수 |
|------|:----:|
| 🔴 Critical | 11개 |
| 🟡 High | 18개 |
| 🟢 Medium | 9개 |
| **총계** | **38개** |

### Phase별 분포

| Phase | 설명 | 🔴 | 🟡 | 🟢 | 합계 |
|-------|------|:--:|:--:|:--:|:----:|
| Phase 1 | 알림 인프라 구축 | 3 | 3 | 2 | 8 |
| Phase 2 | 모임 리마인드 알림 | 3 | 3 | 2 | 8 |
| Phase 3 | 대기자 및 세그먼트 알림 | 3 | 6 | 3 | 12 |
| Phase 4 | 운영자 알림 관리 | 2 | 6 | 2 | 10 |

### 성공/실패 케이스 분포

| 유형 | 개수 |
|------|:----:|
| 성공 케이스 | 33개 |
| 실패 케이스 | 5개 |

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|----------|
| 2026-01-29 | 1.0 | SC-M3 최초 작성 |
