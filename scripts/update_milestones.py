import re

file_path = r'C:\jidokhae-web2\roadmap\milestones.md'

with open(file_path, 'r', encoding='utf-8') as f:
    content = f.read()

# 1. Update Diagram in Overview (more robust waiting for exact match failure previously)
# We will use regex to find the diagram block.
overview_diagram_pattern = re.compile(r'â”Œâ”€+â”\s*â”‚\s*MVP ê°œë°œ Milestones\s*â”‚[\s\S]*?â””â”€+â”˜', re.MULTILINE)

new_overview_diagram = """â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MVP ê°œë°œ Milestones                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  M1: í”„ë¡œì íŠ¸ ê¸°ë°˜ êµ¬ì¶•                                               â”‚
â”‚      â””â”€â”€ ì¸í”„ë¼ ì„¸íŒ…, ì¸ì¦, ê¸°ë³¸ UI                                   â”‚
â”‚          â†“                                                          â”‚
â”‚  M2: ê³„ì¢Œì´ì²´ ì‹ ì²­ & Beta ì˜¤í”ˆ                                       â”‚
â”‚      â””â”€â”€ ì…ê¸ˆ í™•ì¸, ëŒ€ê¸° ì‹ ì²­, ì¡°ê¸° ì‹ ì²­ ì˜¤í”ˆ ê°€ëŠ¥                     â”‚
â”‚          â†“                                                          â”‚
â”‚  M3: ì•Œë¦¼ ì‹œìŠ¤í…œ                                                      â”‚
â”‚      â””â”€â”€ ì•Œë¦¼í†¡ ì—°ë™, ìë™ ë¦¬ë§ˆì¸ë“œ                                   â”‚
â”‚          â†“                                                          â”‚
â”‚  M4: PG ê²°ì œ & ì†Œì†ê°                                                 â”‚
â”‚      â””â”€â”€ ê°„í¸ê²°ì œ ë„ì…, ìë™ í™˜ë¶ˆ, ì¹­ì°¬/ë°°ì§€                         â”‚
â”‚          â†“                                                          â”‚
â”‚  M5: ìš´ì˜ ê³ ë„í™”                                                      â”‚
â”‚      â””â”€â”€ ëŒ€ì‹œë³´ë“œ, ê¶Œí•œ, í…œí”Œë¦¿, ì„œë¹„ìŠ¤ ì™„ì„±                           â”‚
â”‚          â†“                                                          â”‚
â”‚  M6: ì‹ ê·œ íšŒì› & ì¶œì‹œ ì¤€ë¹„                                            â”‚
â”‚      â””â”€â”€ í›„í‚¹í˜ì´ì§€, ì•ˆì •í™”, ì •ì‹ ì¶œì‹œ                                 â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"""

if overview_diagram_pattern.search(content):
    content = overview_diagram_pattern.sub(new_overview_diagram, content)
    print("Overview diagram updated.")
else:
    print("Warning: Overview diagram not found.")

# 2. Update M2 Section
# Pattern: ### M2:.*?--- (non-greedy, including newlines, using DOTALL equivalent)
m2_pattern = re.compile(r'### M2:.*?---', re.DOTALL)

new_m2_content = """### M2: ê³„ì¢Œì´ì²´ ì‹ ì²­ & Beta ì˜¤í”ˆ

**ëª©í‘œ:** **"ë¬´í†µì¥ ì…ê¸ˆìœ¼ë¡œ ì‹ ì²­ ë°›ê¸°"** (ì¡°ê¸° ì˜¤í”ˆ ë‹¬ì„±)  
**ğŸ“‹ Work Package:** [WP-M2-ê³„ì¢Œì´ì²´ì‹ ì²­.md](./work-packages/WP-M2-ê³„ì¢Œì´ì²´ì‹ ì²­.md)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ê¸°ê°„** | 2ì£¼ |
| **ì„ í–‰ ì¡°ê±´** | M1 ì™„ë£Œ |
| **í•µì‹¬ ê°€ì¹˜** | ì‰¬ìš´ ì—°ê²° (ì‹ ì²­ ì‹œì‘) |
| **ê²°ê³¼** | **ğŸš€ Beta ì„œë¹„ìŠ¤ ì˜¤í”ˆ (ì§€ì¸/ê¸°ì¡´ íšŒì› ëŒ€ìƒ)** |

#### ì‚°ì¶œë¬¼

| êµ¬ë¶„ | ì‚°ì¶œë¬¼ |
|------|--------|
| **ì¸ì¦ í™•ì¥** | ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì—°ë™ (Supabase Auth) |
| **ê³„ì¢Œì´ì²´** | ê³„ì¢Œ ì •ë³´ í‘œì‹œ UI (í´ë¦½ë³´ë“œ ë³µì‚¬) |
| | ì…ê¸ˆìëª… ì…ë ¥ ("MMDD_ì´ë¦„") |
| | "ì…ê¸ˆí–ˆìŠµë‹ˆë‹¤" ë²„íŠ¼ â†’ ì •ì› ì˜ˆì•½ |
| | 48ì‹œê°„ íƒ€ì´ë¨¸ ë° ë¯¸ì…ê¸ˆ ë§Œë£Œ ë¡œì§ (ê¸°ë³¸) |
| **ì…ê¸ˆ ê´€ë¦¬** | ìš´ì˜ììš© "ì…ê¸ˆ í™•ì¸" ëª©ë¡ (ê°„ì´) |
| | ì…ê¸ˆ í™•ì¸ ë²„íŠ¼ â†’ ì°¸ê°€ í™•ì • ì²˜ë¦¬ |
| | ì…ê¸ˆ ì·¨ì†Œ/í™˜ë¶ˆ ì²˜ë¦¬ (ìˆ˜ë™ ìƒíƒœ ë³€ê²½) |
| **í™˜ë¶ˆ(ìˆ˜ë™)** | ì·¨ì†Œ ìš”ì²­ UI + í™˜ë¶ˆ ê³„ì¢Œ ì…ë ¥ í¼ |
| | ì·¨ì†Œ ì‚¬ìœ  ì…ë ¥ |
| **ëŒ€ê¸°** | ì •ì› ì´ˆê³¼ ì‹œ ëŒ€ê¸° ë“±ë¡ |
| | ëŒ€ê¸°ì ëª©ë¡ ê´€ë¦¬ |
| | ì·¨ì†Œ ë°œìƒ ì‹œ ìˆ˜ë™ ì•Œë¦¼ (ì•Œë¦¼í†¡ì€ M3) |
| **UI** | ì‹ ì²­ ë²„íŠ¼ í™œì„±í™” |
| | ì°¸ê°€ ì¸ì› í‘œì‹œ ("Oëª… ì°¸ì—¬", ì •ì› ìˆ¨ê¹€) |
| | ë§ˆê° ì„ë°•/ë§ˆê° ìƒíƒœ í‘œì‹œ |
| | ë§ˆì´í˜ì´ì§€ ì‹ ì²­ ë‚´ì—­ (ì…ê¸ˆëŒ€ê¸°/ì™„ë£Œ/ì·¨ì†Œ ìƒíƒœ) |

#### ê²€ì¦ í¬ì¸íŠ¸

- [ ] ê³„ì¢Œì´ì²´ ì‹ ì²­ ì‹œ ì •ì›ì´ ì¦‰ì‹œ ì˜ˆì•½ë¨
- [ ] ìš´ì˜ìê°€ "ì…ê¸ˆ í™•ì¸"ì„ ëˆ„ë¥´ë©´ ë§ˆì´í˜ì´ì§€ì—ì„œ "ì‹ ì²­ ì™„ë£Œ"ë¡œ ë³€ê²½ë¨
- [ ] ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì •ìƒ ë™ì‘
- [ ] ì·¨ì†Œ ì‹œ í™˜ë¶ˆ ê³„ì¢Œ ì…ë ¥ í¼ì´ í‘œì‹œë¨
- [ ] ì •ì› ì´ˆê³¼ ì‹œ ëŒ€ê¸° ë“±ë¡ ê°€ëŠ¥
- [ ] **ì‹¤ì œ íšŒì›ì—ê²Œ ë§í¬ë¥¼ ì¤˜ì„œ ì‹ ì²­ì„ ë°›ì„ ìˆ˜ ìˆìŒ**

> **Strategy:** PG ì‹¬ì‚¬ë¥¼ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³ , ê°€ì¥ ë¹ ë¥¸ ë°©ë²•ì¸ ê³„ì¢Œì´ì²´ë¡œ ë¨¼ì € ì˜¤í”ˆí•˜ì—¬ ì‹ ì²­ì„ ë°›ìŠµë‹ˆë‹¤.

#### ì˜ì¡´ì„± ë‹¤ì´ì–´ê·¸ë¨

```
[M1 ì™„ë£Œ]
    â†“
[M2 ì™„ë£Œ] â†’ ğŸš€ Beta ì˜¤í”ˆ (ì‹ ì²­ ì ‘ìˆ˜ ì‹œì‘)
    â†“
    â†’ M3, M4 ë³‘í–‰ ì‹œì‘
```

---"""

if m2_pattern.search(content):
    content = m2_pattern.sub(new_m2_content, content)
    print("M2 section updated.")
else:
    print("Warning: M2 section not found.")


# 3. Update M4 Section
m4_pattern = re.compile(r'### M4:.*?---', re.DOTALL)

new_m4_content = """### M4: PG ê²°ì œ & ì†Œì†ê°

**ëª©í‘œ:** ê²°ì œ í¸ì˜ì„± ì¦ëŒ€(ìë™í™”) ë° ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥ ê°•í™”  
**ğŸ“‹ Work Package:** [WP-M4-PGì—°ë™ë°ì†Œì†ê°.md](./work-packages/WP-M4-PGì—°ë™ë°ì†Œì†ê°.md)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ê¸°ê°„** | 3ì£¼ |
| **ì„ í–‰ ì¡°ê±´** | M2 ì™„ë£Œ, PG ì‹¬ì‚¬ ì™„ë£Œ |
| **í•µì‹¬ ê°€ì¹˜** | ì‹ ë¢°, ì†Œì†ê° |

#### ì‚°ì¶œë¬¼

| êµ¬ë¶„ | ì‚°ì¶œë¬¼ |
|------|--------|
| **PG ê²°ì œ** | í¬íŠ¸ì› ì—°ë™ (ì¹´ì¹´ì˜¤í˜ì´/í† ìŠ¤í˜ì´ë¨¼ì¸ ) |
| | ê²°ì œ ì™„ë£Œ ì›¹í›… ë° ì‹¤ì‹œê°„ ì²˜ë¦¬ |
| **ìë™ í™˜ë¶ˆ** | í™˜ë¶ˆ ê·œì • ìë™ ê³„ì‚° (ì •ê¸°ëª¨ì„ 5ì¼/2ì¼) |
| | í¬íŠ¸ì› ë¶€ë¶„ í™˜ë¶ˆ API ì—°ë™ |
| **ì°¸ì—¬ ì™„ë£Œ** | ëª¨ì„ ì¢…ë£Œ 3ì¼ í›„ "ì–´ë– ì…¨ì–´ìš”?" ì•Œë¦¼ |
| | [ì¹­ì°¬í•˜ê¸°] [ì°¸ì—¬í–ˆì–´ìš”] [í›„ê¸° ë‚¨ê¸°ê¸°] ì„ íƒ í™”ë©´ |
| | 7ì¼ ë¯¸ì‘ë‹µ ì‹œ ìë™ ì°¸ì—¬ ì™„ë£Œ ì²˜ë¦¬ |
| **ì¹­ì°¬í•˜ê¸°** | ìµëª… ì¹­ì°¬ ì‹œìŠ¤í…œ (ëª¨ì„ë‹¹ 1ëª…, 3ê°œì›” ì œí•œ) |
| | ëˆ„ì  ì¹­ì°¬ ìˆ˜ í‘œì‹œ |
| **ë°°ì§€/í›„ê¸°** | ë°°ì§€ ì‹œìŠ¤í…œ (ì²« ì°¸ì—¬, 10íšŒ ë“±) |
| | í›„ê¸°/ê±´ì˜ ë‚¨ê¸°ê¸° |
| **ë§ˆì´í˜ì´ì§€** | ì´ ì°¸ì—¬ íšŸìˆ˜, ì—°ì† ì°¸ì—¬, "í•¨ê»˜í•œ ì§€ OOOì¼ì§¸" |
| **ë‚´ ì±…ì¥** | ì±… ë“±ë¡ ë° í•œ ë¬¸ì¥ ê¸°ë¡ |

#### ê²€ì¦ í¬ì¸íŠ¸

- [ ] ì¹´ì¹´ì˜¤í˜ì´/í† ìŠ¤ë¡œ ê²°ì œ ì‹œ ì¦‰ì‹œ í™•ì •ë¨
- [ ] ì·¨ì†Œ ì‹œ ê·œì •ì— ë”°ë¼ ìë™ í™˜ë¶ˆë¨
- [ ] ì¹­ì°¬/í›„ê¸° ê¸°ëŠ¥ ë™ì‘ í™•ì¸
- [ ] ë§ˆì´í˜ì´ì§€ í†µê³„ ì •í™•ì„± í™•ì¸

#### ì˜ì¡´ì„± ë‹¤ì´ì–´ê·¸ë¨

```
[M2 ì™„ë£Œ] + [PG ì‹¬ì‚¬ ì™„ë£Œ]
    â†“
[M4 ì™„ë£Œ] â†’ ìë™ ê²°ì œ/í™˜ë¶ˆ ì‹œìŠ¤í…œ ì™„ì„±
    â†“
    â†’ M6 (ì •ì‹ ì¶œì‹œ) í•„ìˆ˜ ì¡°ê±´
```

---"""

if m4_pattern.search(content):
    content = m4_pattern.sub(new_m4_content, content)
    print("M4 section updated.")
else:
    print("Warning: M4 section not found.")


# 4. Update M5 Section
m5_pattern = re.compile(r'### M5:.*?---', re.DOTALL)

new_m5_content = """### M5: ìš´ì˜ ê³ ë„í™”

**ëª©í‘œ:** ìš´ì˜ í”„ë¡œì„¸ìŠ¤ ì™„ì „ ìë™í™” ë° íš¨ìœ¨í™”  
**ğŸ“‹ Work Package:** [WP-M5-ìš´ì˜ê³ ë„í™”.md](./work-packages/WP-M5-ìš´ì˜ê³ ë„í™”.md)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ê¸°ê°„** | 2ì£¼ |
| **ì„ í–‰ ì¡°ê±´** | M3, M4 ì™„ë£Œ |
| **í•µì‹¬ ê°€ì¹˜** | ì‹ ë¢° (ìš´ì˜) |

#### ì‚°ì¶œë¬¼

| êµ¬ë¶„ | ì‚°ì¶œë¬¼ |
|------|--------|
| **ëŒ€ì‹œë³´ë“œ** | ì´ë²ˆ ë‹¬ ì°¸ê°€ í˜„í™©, ìˆ˜ì…, í™˜ë¶ˆ ë‚´ì—­ |
| | ì„¸ê·¸ë¨¼íŠ¸ë³„ íšŒì› ìˆ˜, ì¬ì°¸ì—¬ìœ¨ í†µê³„ |
| **ê¶Œí•œ ê´€ë¦¬** | ìš´ì˜ì§„(ë¶€ìš´ì˜ì) ê¶Œí•œ ë¶€ì—¬ ê¸°ëŠ¥ |
| **ì•Œë¦¼ ê´€ë¦¬** | ì•Œë¦¼ í…œí”Œë¦¿ ìˆ˜ì •, On/Off ê¸°ëŠ¥ |
| **ìš”ì²­í•¨** | ë¬¸ì˜/ê±´ì˜ì‚¬í•­ ê´€ë¦¬ ë° ë‹µë³€ |
| **ë°°ë„ˆ ê´€ë¦¬** | í™ˆ í™”ë©´ ë°°ë„ˆ ê´€ë¦¬ |
| **ê¸°íƒ€** | ë…¸ì‡¼ íšŒì› ì²˜ë¦¬, ì…ê¸ˆ ë¯¸ë§¤ì¹­ ìˆ˜ë™ ì²˜ë¦¬ |

#### ê²€ì¦ í¬ì¸íŠ¸

- [ ] ëŒ€ì‹œë³´ë“œ ë°ì´í„°ê°€ ì •í™•í•¨
- [ ] ë‹¤ë¥¸ ìš´ì˜ì§„(ë¶€ìš´ì˜ì) ê³„ì •ìœ¼ë¡œ ì œí•œì  ì ‘ê·¼ í™•ì¸
- [ ] ì•Œë¦¼ í…œí”Œë¦¿ ìˆ˜ì • ì‹œ ë°˜ì˜ í™•ì¸

#### ì˜ì¡´ì„± ë‹¤ì´ì–´ê·¸ë¨

```
[M3, M4 ì™„ë£Œ]
    â†“
[M5 ì™„ë£Œ] â†’ ìš´ì˜ ì™„ì „ ìë™í™”
    â†“
    â†’ M6 (ì •ì‹ ì¶œì‹œ) ì•ˆì •ì„± í™•ë³´
```

---"""

if m5_pattern.search(content):
    content = m5_pattern.sub(new_m5_content, content)
    print("M5 section updated.")
else:
    print("Warning: M5 section not found.")


# 5. Update Timeline
timeline_pattern = re.compile(r'Week\s+1\s+2.*?```', re.DOTALL)
new_timeline = """Week  1  2  3  4  5  6  7  8  9  10 11 12 13 14
      â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
M1    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚        â”‚        â”‚           â”‚        â”‚        â”‚ ê¸°ë°˜ êµ¬ì¶•
      â”‚     â”‚        â”‚        â”‚           â”‚        â”‚        â”‚
M2    â”‚     â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚        â”‚           â”‚        â”‚        â”‚ ê³„ì¢Œì´ì²´ & Beta ì˜¤í”ˆ ğŸš€
      â”‚     â”‚        â”‚        â”‚           â”‚        â”‚        â”‚
M3    â”‚     â”‚        â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚           â”‚        â”‚        â”‚ ì•Œë¦¼ ì‹œìŠ¤í…œ
      â”‚     â”‚        â”‚        â”‚           â”‚        â”‚        â”‚
M4    â”‚     â”‚        â”‚        â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚        â”‚        â”‚ PG ì—°ë™ & ì†Œì†ê°
      â”‚     â”‚        â”‚        â”‚           â”‚        â”‚        â”‚
M5    â”‚     â”‚        â”‚        â”‚           â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚        â”‚ ìš´ì˜ ê³ ë„í™”
      â”‚     â”‚        â”‚        â”‚           â”‚        â”‚        â”‚
M6    â”‚     â”‚        â”‚        â”‚           â”‚        â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚ ì •ì‹ ì¶œì‹œ
```"""

if timeline_pattern.search(content):
    content = timeline_pattern.sub(new_timeline, content)
    print("Timeline updated.")
else:
    print("Warning: Timeline not found.")


# 6. Update Test Strategy Table (Partial match replacement)
# Search for the table body after "## 7. í…ŒìŠ¤íŠ¸ ì „ëµ"
test_strategy_pattern = re.compile(r'\| M2 ì™„ë£Œ \| Alpha .*?\n\| M4 ì™„ë£Œ \| Beta .*?\n\| M6 ì™„ë£Œ \| ì •ì‹ ì¶œì‹œ .*?\|\n', re.MULTILINE)
new_test_strategy = """| M2 ì™„ë£Œ | Beta (ì¡°ê¸°) | ì§€ì¸ + ì¼ë¶€ íšŒì› (ê³„ì¢Œì´ì²´) | **ì‹¤ì œ ì°¸ê°€ ì‹ ì²­ ì ‘ìˆ˜ ì‹œì‘**, ì…ê¸ˆ/í™˜ë¶ˆ ê²€ì¦ |
| M4 ì™„ë£Œ | Beta (í™•ì¥) | í™œì„± íšŒì› (PG ê²°ì œ) | PG ìë™ ê²°ì œ/í™˜ë¶ˆ ê²€ì¦, ì†Œì†ê° ê¸°ëŠ¥ ë°˜ì‘ |
| M6 ì™„ë£Œ | ì •ì‹ ì¶œì‹œ | ì „ì²´ íšŒì› | ì „ì²´ ê¸°ëŠ¥ ì˜¤í”ˆ |
"""

if test_strategy_pattern.search(content):
    content = test_strategy_pattern.sub(new_test_strategy, content)
    print("Test strategy updated.")
else:
    print("Warning: Test strategy not found.")

# Save file
with open(file_path, 'w', encoding='utf-8') as f:
    f.write(content)

print("File updated successfully.")
